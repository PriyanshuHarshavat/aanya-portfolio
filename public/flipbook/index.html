<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Annie & Froggy — Flipbook</title>
  <style>
    :root {
      --bg1: #0b0f19;
      --bg2: #121a2b;
      --card: rgba(255,255,255,0.08);
      --border: rgba(255,255,255,0.16);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
      --shadow: 0 22px 70px rgba(0,0,0,0.55);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      min-height: 100vh;
      background:
        radial-gradient(1000px 600px at 20% 10%, rgba(255, 80, 80, 0.18), transparent 55%),
        radial-gradient(900px 560px at 82% 18%, rgba(120, 180, 255, 0.18), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x: hidden;
    }
    body::before {
      content: "";
      position: fixed; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='140' height='140' filter='url(%23n)' opacity='.12'/%3E%3C/svg%3E");
      opacity: .10;
      pointer-events: none;
      mix-blend-mode: overlay;
    }

    header {
      position: sticky; top: 0; z-index: 10;
      padding: 14px 16px;
      display: flex; align-items: center; gap: 12px;
      background: rgba(10, 12, 18, 0.55);
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(10px);
    }
    .brand { display: flex; align-items: center; gap: 10px; min-width: 240px; }
    .badge {
      width: 34px; height: 34px;
      border-radius: 11px;
      background: linear-gradient(135deg, rgba(255,80,80,.9), rgba(120,180,255,.9));
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    header h1 { font-size: 14px; margin: 0; font-weight: 700; letter-spacing: 0.2px; line-height: 1.1; }
    header .sub { display:block; font-size: 12px; color: var(--muted); font-weight: 500; margin-top: 2px; }
    .spacer { flex: 1; }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 999px;
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: 0 10px 35px rgba(0,0,0,.25);
    }
    .counter { font-size: 12px; color: var(--muted); white-space: nowrap; }

    button {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.07);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 12px;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select: none;
    }
    button:hover { background: rgba(255,255,255,0.12); border-color: rgba(255,255,255,0.22); }
    button:active { transform: translateY(1px) scale(0.99); }
    button.primary { background: rgba(255, 80, 80, 0.18); border-color: rgba(255, 80, 80, 0.35); }
    button.primary:hover { background: rgba(255, 80, 80, 0.24); }

    #root { display: grid; place-items: center; padding: 18px 12px 0; }

    .stage { width: min(1050px, 96vw); }
    .frame { border-radius: var(--radius); border: 1px solid var(--border); background: rgba(255,255,255,0.04); box-shadow: var(--shadow); overflow: hidden; }

    #book {
      width: 100%;
      height: min(680px, 72vh);
      background:
        radial-gradient(1000px 500px at 50% 0%, rgba(255,255,255,0.08), transparent 60%),
        #171a22;
    }

    .page { width: 100%; height: 100%; background: #fff; display: flex; align-items: center; justify-content: center; }
    .page img { width: 100%; height: 100%; object-fit: contain; background: #fff; }

    .strip {
      display: flex;
      gap: 10px;
      padding: 12px 12px 14px;
      overflow-x: auto;
      scrollbar-width: thin;
      background: rgba(0,0,0,0.22);
      border-top: 1px solid var(--border);
    }
    .thumb {
      width: 86px;
      height: 62px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      overflow: hidden;
      flex: 0 0 auto;
      background: rgba(255,255,255,0.06);
      cursor: pointer;
      opacity: 0.85;
      transition: opacity .15s ease, transform .15s ease, border-color .15s ease;
      position: relative;
    }
    .thumb:hover { opacity: 1; transform: translateY(-1px); border-color: rgba(255,255,255,0.28); }
    .thumb.active { opacity: 1; border-color: rgba(120,180,255,0.55); box-shadow: 0 10px 28px rgba(0,0,0,0.35); }
    .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; background: #fff; }
    .thumb .n {
      position: absolute; right: 6px; bottom: 6px;
      font-size: 10px; padding: 2px 6px; border-radius: 999px;
      background: rgba(0,0,0,0.45);
      border: 1px solid rgba(255,255,255,0.18);
      color: rgba(255,255,255,0.92);
      backdrop-filter: blur(6px);
    }

    .hint { text-align: center; font-size: 12px; color: var(--muted); padding: 12px 14px 18px; }

    .loading {
      position: fixed; inset: 0;
      display: grid; place-items: center;
      background:
        radial-gradient(900px 560px at 20% 10%, rgba(255, 80, 80, 0.16), transparent 55%),
        radial-gradient(900px 560px at 82% 18%, rgba(120, 180, 255, 0.16), transparent 55%),
        linear-gradient(180deg, #070a12, #0c1325);
      z-index: 50;
    }
    .loading .card {
      width: min(520px, 92vw);
      padding: 18px 18px 16px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      box-shadow: var(--shadow);
      text-align: left;
    }
    .bar {
      margin-top: 12px;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.10);
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.14);
    }
    .bar > div {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,80,80,.9), rgba(120,180,255,.9));
      transition: width .2s ease;
    }
    .loading h2 { margin: 0; font-size: 16px; letter-spacing: .2px; }
    .loading p { margin: 6px 0 0; color: var(--muted); font-size: 12px; line-height: 1.35; }
  </style>
</head>
<body>

  <div class="loading" id="loading">
    <div class="card">
      <h2>Opening Annie & Froggy…</h2>
      <p>Loading pages for a smooth, real-book flip experience.</p>
      <div class="bar"><div id="prog"></div></div>
      <p style="margin-top:10px; font-size:11px; color:rgba(255,255,255,.62)">Tip: use Fullscreen for the best feel.</p>
    </div>
  </div>

  <header>
    <div class="brand">
      <div class="badge" aria-hidden="true"></div>
      <div>
        <h1>Annie & Froggy <span class="sub">Make A Friend — by Aanya Harshavat</span></h1>
      </div>
    </div>

    <div class="spacer"></div>

    <div class="pill">
      <span class="counter" id="counter">1 / 1</span>
      <button id="prev">◀</button>
      <button id="next">▶</button>
      <button id="zoom" title="Toggle bigger book">Zoom</button>
      <button id="sound" title="Toggle page flip sound">Sound: Off</button>
      <button id="share" class="primary" title="Copy link">Share</button>
      <button id="fs" title="Fullscreen">Fullscreen</button>
    </div>
  </header>

  <div id="root">
    <div class="stage frame">
      <div id="book"></div>
      <div class="strip" id="strip"></div>
    </div>

    <div class="hint">
      Swipe on mobile • drag corners on desktop • jump with thumbnails below
    </div>
  </div>

  <script src="https://unpkg.com/page-flip/dist/js/page-flip.browser.js"></script>
  <script>
    const pages = ["cover_R.png", "p00_L.png", "p00_R.png", "p01_L.png", "p01_R.png", "p02_L.png", "p02_R.png", "p03_L.png", "p03_R.png", "p04_L.png", "p04_R.png", "p05_L.png", "p05_R.png", "p06_L.png", "p06_R.png", "p07_L.png", "p07_R.png", "p08_L.png", "p08_R.png", "p09_L.png", "p09_R.png", "p10_L.png", "p10_R.png", "p11_L.png", "p11_R.png", "p12_L.png", "p12_R.png", "p13_L.png", "p13_R.png", "p14_L.png", "p14_R.png", "cover_L.png"];
    const bookEl = document.getElementById('book');
    const counterEl = document.getElementById('counter');
    const stripEl = document.getElementById('strip');
    const loadingEl = document.getElementById('loading');
    const progEl = document.getElementById('prog');

    // Optional page flip sound (simple WebAudio)
    let soundOn = false;
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    let ctx = null;
    function playFlip() {
      if (!soundOn) return;
      try {
        if (!ctx) ctx = new AudioCtx();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "triangle";
        o.frequency.setValueAtTime(480, ctx.currentTime);
        o.frequency.exponentialRampToValueAtTime(180, ctx.currentTime + 0.06);
        g.gain.setValueAtTime(0.0001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.08, ctx.currentTime + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.08);
        o.connect(g); g.connect(ctx.destination);
        o.start();
        o.stop(ctx.currentTime + 0.09);
      } catch(e) {}
    }

    // Create HTML pages
    const pageNodes = pages.map((src, i) => {
      const div = document.createElement('div');
      div.className = 'page';
      const img = document.createElement('img');
      img.loading = 'eager';
      img.src = 'assets/' + src;
      img.alt = 'Page ' + (i+1);
      div.appendChild(img);
      return div;
    });
    pageNodes.forEach(n => bookEl.appendChild(n));

    // Preload images with progress
    let loaded = 0;
    function updateProgress() {
      const pct = Math.round((loaded / pages.length) * 100);
      progEl.style.width = pct + "%";
      if (loaded >= pages.length) {
        setTimeout(() => { loadingEl.style.display = "none"; }, 250);
      }
    }
    pages.forEach((src) => {
      const im = new Image();
      im.onload = () => { loaded++; updateProgress(); };
      im.onerror = () => { loaded++; updateProgress(); };
      im.src = "assets/" + src;
    });
    updateProgress();

    const pf = new St.PageFlip(bookEl, {
      width: 490,
      height: 680,
      size: "stretch",
      minWidth: 315,
      maxWidth: 1200,
      minHeight: 420,
      maxHeight: 1600,
      maxShadowOpacity: 0.35,
      showCover: true,
      mobileScrollSupport: false
    });
    pf.loadFromHTML(pageNodes);

    function setActiveThumb(index) {
      const thumbs = stripEl.querySelectorAll('.thumb');
      thumbs.forEach(t => t.classList.remove('active'));
      const t = thumbs[index];
      if (t) {
        t.classList.add('active');
        t.scrollIntoView({behavior:"smooth", inline:"center", block:"nearest"});
      }
    }

    function updateCounter() {
      const idx = pf.getCurrentPageIndex() + 1;
      counterEl.textContent = idx + " / " + pages.length;
      setActiveThumb(pf.getCurrentPageIndex());
    }

    pf.on('flip', () => { updateCounter(); playFlip(); });
    updateCounter();

    document.getElementById('prev').onclick = () => pf.flipPrev();
    document.getElementById('next').onclick = () => pf.flipNext();

    let zoomed = false;
    document.getElementById('zoom').onclick = () => {
      zoomed = !zoomed;
      bookEl.style.height = zoomed ? "min(820px, 78vh)" : "min(680px, 72vh)";
      setTimeout(() => pf.update(), 50);
    };

    document.getElementById('fs').onclick = async () => {
      const el = document.documentElement;
      try {
        if (!document.fullscreenElement) await el.requestFullscreen();
        else await document.exitFullscreen();
      } catch (e) {}
    };

    document.getElementById('sound').onclick = () => {
      soundOn = !soundOn;
      document.getElementById('sound').textContent = "Sound: " + (soundOn ? "On" : "Off");
      if (soundOn && !ctx) { try { ctx = new AudioCtx(); ctx.resume(); } catch(e) {} }
    };

    document.getElementById('share').onclick = async () => {
      const url = window.location.href;
      try {
        await navigator.clipboard.writeText(url);
        const b = document.getElementById('share');
        const old = b.textContent;
        b.textContent = "Copied!";
        setTimeout(() => b.textContent = old, 900);
      } catch (e) {
        prompt("Copy this link:", url);
      }
    };

    // Thumbnails filmstrip
    pages.forEach((src, i) => {
      const t = document.createElement('div');
      t.className = 'thumb';
      const im = document.createElement('img');
      im.loading = 'lazy';
      im.src = 'assets/' + src;
      im.alt = 'Thumb ' + (i+1);
      const n = document.createElement('div');
      n.className = 'n';
      n.textContent = i+1;
      t.appendChild(im);
      t.appendChild(n);
      t.onclick = () => pf.flip(i);
      stripEl.appendChild(t);
    });
    setActiveThumb(0);
  </script>
</body>
</html>
